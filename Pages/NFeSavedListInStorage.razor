@page "/list"
@using LeitorNfe.Core.Models
@using LeitorNfe.Core.Models.DTOs
@using LeitorNfe.Core.Services
@using LeitorNfe.Core.Services.Responses
@using Microsoft.AspNetCore.Mvc

<h3>NFe In Storage List</h3>

@if (nFesInStorage != null && nFesInStorage.Any())
{
    <ul>
        @foreach (var nfe in nFesInStorage)
        {
            <li>@nfe.Directory</li>
        <ul>
            @if (nfe.NFe != null)
            {
                <ul>
                    <li>
                        <ul>
                            <li>Id: @(nfe.NFe.Id)</li>
                        @if (nfe.NFe.InfNFe != null)    
                        {
                            @if (nfe.NFe.InfNFe.Ide != null) 
                            {
                                <li>cUF: @nfe.NFe.InfNFe.Ide.cUF</li>
                                <li>cNF: @nfe.NFe.InfNFe.Ide.cNF</li>  
                            }

                            @if (nfe.NFe.InfNFe.Emit != null) 
                            {
                                <li>Emitente: @nfe.NFe.InfNFe.Emit.xNome</li>
                            }
                            else
                            {
                                <li>Não tem emitente.</li>
                            }
                            
                            @if (nfe.NFe.InfNFe.Dest != null) 
                            {
                                <li>Destinatário: @nfe.NFe.InfNFe.Dest.xNome</li>
                            }
                            else 
                            {
                                <li>Não tem destinatário.</li>
                            }

                            <li>Produtos:
                                <ul>
                                    @if (nfe.NFe.InfNFe.Det != null) 
                                    {
                                        @foreach (var det in nfe.NFe.InfNFe.Det)
                                        {
                                            <li>
                                                <ul>
                                                    <li>cProd: @det.Prod.cProd</li>
                                                    <li>xProd: @det.Prod.xProd</li>
                                                    <li>qCom: @det.Prod.qCom</li>
                                                </ul>
                                            </li>
                                        }
                                    }
                                </ul>
                            </li> 
                        }
                        </ul>
                    </li>
                </ul>
            }
            else
            {
                <p>NFe is null for this item.</p>
            }
        </ul>
        }
    </ul>
}
else
{
    <p>No NFes in storage.</p>
}

@code {
    [Inject] private INFeInStorageService NFeInStorageService {get; set;}
    private List<NFeInStorage> nFesInStorage;


    protected override async Task OnInitializedAsync()
    {
        var response = await NFeInStorageService.GetNFes();
        nFesInStorage = response?.NFesInStorage;
        nFesInStorage = nFesInStorage.ToList();
   }
}
